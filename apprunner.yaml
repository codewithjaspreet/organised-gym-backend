version: 1.0
runtime: python311

build:
  commands:
    build:
      - pip3 install --upgrade pip
      - pip3 install -r requirements.txt

run:
  runtime-version: 3.11

  command: python3 -m uvicorn main:app --host 0.0.0.0 --port 8080

  network:
    port: 8080
    env: PORT

  env:
    - name: APP_NAME
      value: "Organised Gym"

    - name: ALGORITHM
      value: "HS256"

    - name: ACCESS_TOKEN_EXPIRE_MINUTES
      value: "43200"

    - name: REFRESH_TOKEN_EXPIRE_DAYS
      value: "7"

    # üîê Secrets Manager references
    - name: DB_CONNECTION_URL
      valueFrom:
        secretsManager:
          secretName: organised-gym/prod
          jsonKey: DB_CONNECTION_URL

    - name: SECRET_KEY
      valueFrom:
        secretsManager:
          secretName: organised-gym/prod
          jsonKey: SECRET_KEY

    - name: CLOUDINARY_CLOUD_NAME
      valueFrom:
        secretsManager:
          secretName: organised-gym/prod
          jsonKey: CLOUDINARY_CLOUD_NAME

    - name: CLOUDINARY_CLOUD_API_KEY
      valueFrom:
        secretsManager:
          secretName: organised-gym/prod
          jsonKey: CLOUDINARY_CLOUD_API_KEY

    - name: CLOUDINARY_CLOUD_API_SECRET
      valueFrom:
        secretsManager:
          secretName: organised-gym/prod
          jsonKey: CLOUDINARY_CLOUD_API_SECRET

    - name: CLOUDINARY_URL
      valueFrom:
        secretsManager:
          secretName: organised-gym/prod
          jsonKey: CLOUDINARY_URL

    - name: FIREBASE_SERVICE_ACCOUNT_JSON_BASE64
      valueFrom:
        secretsManager:
          secretName: organised-gym/prod
          jsonKey: FIREBASE_SERVICE_ACCOUNT_JSON_BASE64
